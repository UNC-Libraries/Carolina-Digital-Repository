function CdrGraphs(a,b,c){this.margins={top:50,right:150,bottom:75,left:150},this.stringDate=d3.time.format("%b %e, %Y"),this.height=500-this.margins.top-this.margins.bottom,this.data_store={},this.operations=a,this.deposits=b,this.scatter_tip=c}!function(){function a(a){function b(a){if("string"==typeof a){var b,c={},d=a.split(e);for(a=d.shift();b=d.shift();)"."==b?c["class"]=c["class"]?c["class"]+" "+d.shift():d.shift():"#"==b&&(c.id=d.shift());return c.id||c["class"]?{tag:a,attr:c}:a}return a}function c(b){return"function"==typeof b?b:(b=a.ns.qualify(b)).local?function(){return this.ownerDocument.createElementNS(b.space,b.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,b)}}function d(a){return"function"==typeof a?a:function(){return this.querySelector(a)}}a.selection.prototype.translate=function(a){return this.attr("transform",function(b,c){return"translate("+["function"==typeof a?a.call(this,b,c):a]+")"})},a.transition.prototype.translate=function(a){return this.attr("transform",function(b,c){return"translate("+["function"==typeof a?a.call(this,b,c):a]+")"})},a.selection.prototype.tspans=function(a,b){return this.selectAll("tspan").data(a).enter().append("tspan").text(function(a){return a}).attr("x",0).attr("dy",function(a,c){return c?b||15:0})},a.selection.prototype.append=a.selection.enter.prototype.append=function(a){var d,e=b(a);return a=e.attr?e.tag:a,a=c(a),d=this.select(function(){return this.appendChild(a.apply(this,arguments))}),e.attr?d.attr(e.attr):d},a.selection.prototype.insert=a.selection.enter.prototype.insert=function(a,e){var f,g=b(a);return a=g.attr?g.tag:a,a=c(a),e=d(e),f=this.select(function(){return this.insertBefore(a.apply(this,arguments),e.apply(this,arguments)||null)}),g.attr?f.attr(g.attr):f};var e=/([\.#])/g;a.wordwrap=function(a,b){var c=a.split(" "),d=[],e=[],f=b||40,g=0;return c.forEach(function(a){g+a.length>f&&(d.push(e.join(" ")),e.length=0,g=0),g+=a.length,e.push(a)}),e.length&&d.push(e.join(" ")),d},a.ascendingKey=function(a){return"function"==typeof a?function(b,c){return a(b)<a(c)?-1:a(b)>a(c)?1:a(b)>=a(c)?0:NaN}:function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:b[a]>=c[a]?0:NaN}},a.descendingKey=function(a){return"function"==typeof a?function(b,c){return a(c)<a(b)?-1:a(c)>a(b)?1:a(c)>=a(b)?0:NaN}:function(b,c){return c[a]<b[a]?-1:c[a]>b[a]?1:c[a]>=b[a]?0:NaN}},a.f=function(){for(var a=arguments,b=0,c=a.length;c>b;)"string"!=typeof a[b]&&"number"!=typeof a[b]||(a[b]=function(a){return function(b){return b[a]}}(a[b])),b++;return function(b){for(var c=0,d=a.length;c++<d;)b=a[c-1].call(this,b);return b}},window.hasOwnProperty("ƒ")||(window.ƒ=a.f);var f=a.selection.prototype.on;a.selection.prototype.on=function(a,b,c){if("string"==typeof a&&a.indexOf(" ")>-1){a=a.split(" ");for(var d=0;d<a.length;d++)f.apply(this,[a[d],b,c])}else f.apply(this,[a,b,c]);return this},a.selection.prototype.prop=a.selection.prototype.property}"object"==typeof d3&&d3.version?a(d3):"function"==typeof define&&define.amd&&define(["d3"],a)}(),function(){"use strict";var a=function(a,b){return Object.prototype.hasOwnProperty.call(b,a)},b=function(a){return null!=a&&"object"==typeof a&&a["@@functional/placeholder"]===!0},c=function(a){return function c(d){return 0===arguments.length||b(d)?c:a.apply(this,arguments)}},d=function(a){return function d(e,f){switch(arguments.length){case 0:return d;case 1:return b(e)?d:c(function(b){return a(e,b)});default:return b(e)&&b(f)?d:b(e)?c(function(b){return a(b,f)}):b(f)?c(function(b){return a(e,b)}):a(e,f)}}},e=function(a){return function e(f,g,h){switch(arguments.length){case 0:return e;case 1:return b(f)?e:d(function(b,c){return a(f,b,c)});case 2:return b(f)&&b(g)?e:b(f)?d(function(b,c){return a(b,g,c)}):b(g)?d(function(b,c){return a(f,b,c)}):c(function(b){return a(f,g,b)});default:return b(f)&&b(g)&&b(h)?e:b(f)&&b(g)?d(function(b,c){return a(b,c,h)}):b(f)&&b(h)?d(function(b,c){return a(b,g,c)}):b(g)&&b(h)?d(function(b,c){return a(f,b,c)}):b(f)?c(function(b){return a(b,g,h)}):b(g)?c(function(b){return a(f,b,h)}):b(h)?c(function(b){return a(f,g,b)}):a(f,g,h)}}},f=e(function(b,c,d){var e,f={};for(e in c)a(e,c)&&(f[e]=a(e,d)?b(e,c[e],d[e]):c[e]);for(e in d)a(e,d)&&!a(e,f)&&(f[e]=d[e]);return f}),g={mergeWithKey:f};"object"==typeof exports?module.exports=g:"function"==typeof define&&define.amd?define(function(){return g}):this.R=g}.call(this),CdrGraphs.prototype.xScales=function(a,b){return d3.time.scale().domain(d3.extent(a,d3.f("date"))).range([0,b])},CdrGraphs.prototype.yScales=function(a,b,c){return d3.scale.sqrt().domain([d3.max(a,d3.f(b)),0]).range(c)},CdrGraphs.prototype.getAxis=function(a,b){return d3.svg.axis().scale(a).orient(b)},CdrGraphs.prototype.showAxises=function(a,b,c,d,e){var f=d3.select(a);return f.attr("width",d+this.margins.left+this.margins.right).attr("height",this.height+this.margins.top+this.margins.bottom),f.append("g").attr("class","x axis").translate([this.margins.left,this.height+this.margins.top]),d3.selectAll(a+" g.x").call(b),f.append("g").attr("class","y axis").translate([this.margins.left,this.margins.top]),d3.selectAll(a+" g.y").call(c),f.append("text").attr("transform","rotate(-90)").attr("x",-this.height/2).attr("y",6).attr("dy","5em").style("text-anchor","end").text(e),f},CdrGraphs.prototype.drawCircles=function(a,b,c,d,e){var f=this,g=a.selectAll("circle").data(b);return g.enter().append("circle"),g.translate([this.margins.left,this.margins.top]).on("mouseover",function(a){var b=/(time|throughput|duration)/.test(e)?f.tipTextDeposits(a):f.tipTextOperations(a);f.tipShow(f.scatter_tip,b),d3.select(this).attr("r",9).style("stroke-width",3)}).on("mouseout",function(a){f.tipHide(f.scatter_tip),d3.select(this).attr("r",4.5).style("stroke-width",1)}),g.transition().duration(1e3).delay(function(a,b){return 5*b}).ease("sin-in-out").attr("cx",function(a){return c(a.date)}).attr("cy",function(a){return d(a[e])}).attr("r",4.5),g.exit().remove(),g},CdrGraphs.prototype.numFormat=function(a){var b=/\./.test(a)?d3.format(",.2f"):d3.format(",");return b(a)},CdrGraphs.prototype.tipTextOperations=function(a){var b="<h5 class='text-center smaller'>"+this.stringDate(a.date)+"</h5>";return b+="<p class='text-center'>Deposit Metrics</p><ul class='list-unstyled smaller'><li>Files Ingested: "+this.numFormat(a.throughput_files)+"</li><li>Total MB Ingested: "+this.numFormat(a.throughput_bytes)+"</li><li>Avg Filesize (MB): "+this.numFormat(a.avg_filesize)+"</li></ul><p class='text-center'>Operations Metrics</p><ul class='list-unstyled smaller'><li>Moves: "+this.numFormat(a.moves)+"</li><li>Finished Enh: "+this.numFormat(a.finished_enhancements)+"</li><li>Failed Enh: "+this.numFormat(a.failed_enhancements)+"</li></ul>"},CdrGraphs.prototype.tipTextDeposits=function(a){var b="<h5 class='text-center smaller'>"+this.stringDate(a.date)+"</h5>";return b+=void 0!==a.uuid?a.uuid:"",b+="<p class='text-center'>Deposit Metrics</p><ul class='list-unstyled smaller'>",void 0!==a.throughput_files&&(b+="<li>Files Ingested: "+this.numFormat(a.throughput_files)+"</li><li>Total MB Ingested: "+this.numFormat(a.throughput_bytes)+"</li><li>Avg Filesize (MB): "+this.numFormat(a.avg_filesize)+"</li>"),b+="<li>Total Time: "+this.numFormat(a.total_time)+"</li><li>Queued Time: "+this.numFormat(a.queued_duration)+"</li><li>Ingest Time: "+this.numFormat(a.ingest_duration)+"</li></ul>"},CdrGraphs.prototype.tipShow=function(a,b){a.transition().duration(200).style("opacity",.9),a.html(b).style("top",d3.event.pageY+8+"px").style("left",d3.event.pageX-100+"px")},CdrGraphs.prototype.tipHide=function(a){a.transition().duration(300).style("opacity",0)},CdrGraphs.prototype.barWidth=function(a,b){return a/b.length-.3},CdrGraphs.prototype.colorList=function(a){switch(a){case"throughput_bytes":return["#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"];case"total_time":return["#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"];case"moves":return["#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"];case"finished_enhancements":return["#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"];case"failed_enhancements":return["#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"];default:return["#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]}},CdrGraphs.prototype.stripColors=function(a,b){var c=this.colorList(b);return d3.scale.quantize().domain([0,d3.max(a,function(a){return a[b]})]).range(c)},CdrGraphs.prototype.drawLegend=function(a,b,c){var d=this.stripColors(b,c),e="legend-"+c,f=d3.select(a).attr("height",50).attr("width",1500);f.append("g").attr("class",e).attr("width",1200).translate([this.margins.left,0]);var g=d3.legend.color().shapeWidth(90).cells(9).orient("horizontal").labelFormat(d3.format(",.4r"));return g.scale(d),f.select("."+e).call(g),f},CdrGraphs.prototype.hideShow=function(){d3.select("#loader").classed("hide",!0),d3.selectAll(".dim").classed("dim",!1)},CdrGraphs.prototype.chartUpdate=function(a,b,c,d){var e,f=this;d3.selectAll("."+a).on("click",function(a){var g,h,i=d3.event.target.id,j=d3.select("#"+i).text();/^(all_throughput|all_avg)/.test(i)?(g=i.substr(4),h="#files-by-day",e=f.data_store["files-by-day"]):/file/.test(i)?(g=i,h="#files-by-ingest",e=f.data_store["files-by-ingest"]):/^all/.test(i)?(g=i.substr(4),h="#duration-total-date",e=f.data_store["duration-total-date"]):(g=i,h="#duration-date",e=f.data_store["duration-date"]),d3.select(h+"-text").text(j),c.domain([d3.max(e,function(a){return a[g]}),0]),d3.select(h+" g.y.axis").transition().duration(1500).ease("sin-in-out").call(d);var k=d3.select(h);f.drawCircles(k,e,b,c,g)})},CdrGraphs.prototype.fileAvg=function(a){var b=a.throughput_bytes/a.throughput_files;return Number.isNaN(b)?0:b},CdrGraphs.prototype.dateSort=function(a){return a.sort(function(a,b){return a.date-b.date})},CdrGraphs.prototype.counts=function(a,b){var c=d3.nest().key(function(a){return a.date}).rollup(function(a){return d3.sum(a,function(a){return a[b]})}).entries(a),d=[];return c.forEach(function(a){var c={date:a.key};c[b]=+a.values,d.push(c)}),d},CdrGraphs.prototype.keyFunction=function(){function a(a,b,c){var d;if("date"!==a)d=parseInt(b)+parseInt(c);else{if("avg_filesize"==a)return;d="object"==typeof b?b:new Date(b)}return d}return a},CdrGraphs.prototype.combined=function(a,b){for(var c=[],d=this.keyFunction(),e=function(a){return"object"==typeof a?a.toString():a},f=!1,g=0;g<a.length;g++){for(var h=0;h<b.length;h++){if(e(a[g].date)==e(b[h].date)){c.push(R.mergeWithKey(d,a[g],b[h])),f=!0;break}f=!1}f||c.push(a[g])}return c},CdrGraphs.prototype.draw=function(){function a(a,b,e){var f=c.stripColors(b,e),g=c.barWidth(d,c.operations),h=d3.tip().attr("class","d3-tip").html(function(a){return c.tipTextOperations(a)}),j=d3.select(a).attr("width",d+c.margins.left+c.margins.right).attr("height",110).call(h),k=j.selectAll("bar").data(b);return k.enter().append("rect"),k.attr("x",function(a){return i(a.date)}).attr("width",g).attr("y",0).attr("height",80).translate([c.margins.left,0]).style("fill",function(a){return f(a[e])}).on("mouseover",function(a){d3.select(this).attr("height",100),h.show.call(this,a)}).on("mouseout",function(a){d3.select(this).attr("height",80),h.hide.call(this,a)}),k.exit().remove(),k}function b(a,b,e){function f(){var a=i.invert(d3.mouse(this)[0]),d=h(b,a,1),f=b[d-1],j=b[d];void 0===j&&(j=1/0);var k=a-f.key>j.key-a?j:f,l=[i(k.date)+g.left,g.top];d3.select(e+" line.y0").translate(l),c.scatter_tip.transition().duration(100).style("opacity",.9),c.scatter_tip.html(c.tipTextOperations(k)).style("top",d3.event.pageY-28+"px").style("left",d3.event.pageX-158+"px")}var g=c.margins,h=d3.bisector(d3.f("date")).right,j=a.append("g").attr("class","focus").style("display","none");return j.append("line").attr("class","y0").attr({x1:0,y1:0,x2:0,y2:c.height}),a.append("rect").attr("class","overlay").attr("width",d).attr("height",c.height).on("mouseover touchstart",function(){j.style("display",null)}).on("mouseout touchend",function(){j.style("display","none"),c.scatter_tip.transition().duration(250).style("opacity",0)}).on("mousemove touchmove",f).translate([g.left,g.top]),a}var c=this,d=window.innerWidth-this.margins.left-this.margins.right,e=d3.time.format("%Y-%m-%d").parse;this.operations.forEach(function(a){a.date="object"==typeof a.date?a.date:e(a.date),a.throughput_bytes=""===a.throughput_bytes?0:a.throughput_bytes/1e6,a.throughput_files=""===a.throughput_files?0:+a.throughput_files,a.moves=""===a.moves?0:+a.moves,a.finished_enhancements=""===a.finished_enhancements?0:+a.finished_enhancements,a.failed_enhancements=""===a.failed_enhancements?0:+a.failed_enhancements});var f=this.dateSort(this.operations);this.deposits.forEach(function(a){a.date="object"==typeof a.date?a.date:e(a.date),a.ingest_duration=a.ingest_duration/1e3,a.queued_duration=a.queued_duration/1e3,a.total_time=a.ingest_duration+a.queued_duration,a.throughput_bytes=""===a.throughput_bytes?0:a.throughput_bytes/1e6,a.throughput_files=""===a.throughput_files?0:+a.throughput_files,a.avg_filesize=c.fileAvg(a)});var g=this.dateSort(this.deposits),h=[0,this.height],i=this.xScales(f,d),j=this.xScales(g,d),k=this.counts(g,"throughput_bytes"),l=this.counts(g,"throughput_files"),m=this.combined(k,l),n=this.combined(f,m),o=this.combined(this.counts(g,"ingest_duration"),this.counts(g,"queued_duration")),p=this.combined(o,this.counts(g,"total_time"));n.forEach(function(a){a.avg_filesize=c.fileAvg(a)}),p.forEach(function(a){a.avg_filesize=c.fileAvg(a)});var q="throughput_bytes",r=this.yScales(n,q,h),s=this.getAxis(i,"bottom"),t=this.getAxis(r,"left"),u=this.showAxises("#throughput-date",s,t,d,"Throughput (MB)");this.drawCircles(u,n,i,r,q),b(u,n,"#throughput-date"),this.drawLegend("#throughput-legend",n,q),a("#throughput-date-strip",n,q);var v=this.yScales(g,q,h),w=this.getAxis(j,"bottom"),x=this.getAxis(v,"left"),y=this.showAxises("#throughput-deposit",w,x,d,"Throughput (MB)");this.drawCircles(y,g,j,v,q);var z="throughput_files",A=this.yScales(g,z,h),B=this.getAxis(j,"bottom"),C=this.getAxis(A,"left"),D=this.showAxises("#files-by-ingest",B,C,d,"Throughput (Files)");this.drawCircles(D,g,j,A,z),this.data_store["files-by-ingest"]=g,this.chartUpdate("files-uuid",j,A,C);var E=this.yScales(n,z,h),F=this.getAxis(E,"left"),G=this.showAxises("#files-by-day",s,F,d,"Throughput (Files)");this.drawCircles(G,n,i,E,z),b(G,n,"#files-by-day"),this.data_store["files-by-day"]=n,this.chartUpdate("files",i,E,F),this.drawLegend("#files-legend",n,z),a("#files-strip",n,z);var H="total_time",I=this.yScales(g,H,h),J=this.getAxis(j,"bottom"),K=this.getAxis(I,"left"),L=this.showAxises("#duration-date",J,K,d,"Time (Seconds)");this.drawCircles(L,g,j,I,H),this.data_store["duration-date"]=g,this.chartUpdate("time-uuid",j,I,K);var M=this.yScales(p,H,h),N=this.getAxis(j,"bottom"),O=this.getAxis(M,"left"),P=this.showAxises("#duration-total-date",N,O,d,"Time (Seconds)");this.drawCircles(P,p,j,M,H),this.data_store["duration-total-date"]=p,this.chartUpdate("time",j,M,O);var Q="moves",R=this.yScales(f,Q,h),S=this.getAxis(R,"left"),T=this.showAxises("#moves-date",s,S,d,"Move Operations");this.drawCircles(T,f,i,R,Q),b(T,f,"#moves-date"),this.drawLegend("#moves-legend",f,Q),a("#moves-date-strip",f,Q);var U="finished_enhancements",V=this.yScales(f,U,h),W=this.getAxis(V,"left"),X=this.showAxises("#enh-date",s,W,d,"Finished Enhancements");this.drawCircles(X,f,i,V,U),b(X,f,"#enh-date"),this.drawLegend("#enh-legend",f,U),a("#enh-date-strip",f,U);var Y="failed_enhancements",Z=this.yScales(f,Y,h),$=this.getAxis(Z,"left"),_=this.showAxises("#failed-enh-date",s,$,d,"Failed Enhancements");this.drawCircles(_,f,i,Z,Y),b(_,f,"#failed-enh-date"),this.drawLegend("#failed-enh-legend",f,Y),a("#failed-enh-date-strip",f,Y),this.hideShow()};
//# sourceMappingURL=cdr-visualizations.min.js.map